{% extends "base_form.html" %}
{% block form_fields %}
  <div>
          {% include 'touglates/form_field.html' with field=form.title %}
      </div>
      <div>
        {% include 'touglates/form_field.html' with field=form.description %}
      </div>
      <div>
        {% include 'touglates/form_field.html' with field=form.priority %}
      </div>
      <div>
        {% include 'touglates/form_field.html' with field=form.due_date %}
      </div>
      <div>
        {{ form.done_date.as_hidden }}
        {% with checkbox='<input id="chk_done" type="checkbox">' %}
        {% include 'touglates/form_field.html' with field=checkbox label_tag="Done" %}
        {% endwith %}
      </div>

      <input type="submit" value="Submit">
      {% if object.pk %}
      <button id="btn_delete" type="button" onclick="location.href='{% url "tougdo:item-delete" object.pk %}'">Delete</button>
      {% endif %}
{% endblock %}
{% block afterform %}
  <script>
    document.getElementById('chk_done').addEventListener('click', function(e) {
      done_date = document.getElementById('{{ form.done_date.id_for_label }}')
      if(e.target.checked){
        done_date.value = new Date().toISOString().substring(0,10)
      } else {
        done_date.value = ''
      }
    });
    </script>
  <script>
    function adjustDate(days) {
      due_date = new Date(inp_due_date.value)
      due_date.setDate(due_date.getDate() + days)
      inp_due_date.valueAsDate = due_date
    }
    inp_due_date = document.getElementById('{{ form.due_date.id_for_label }}')

    btn_decrease_week = document.createElement('button')
    btn_decrease_week.type="button"
    btn_decrease_week.innerHTML = '<<'
    inp_due_date.parentNode.insertBefore(btn_decrease_week, inp_due_date )

    btn_decrease = document.createElement('button')
    btn_decrease.type="button"
    btn_decrease.innerHTML = '<'
    inp_due_date.parentNode.insertBefore(btn_decrease, inp_due_date )

    btn_increase_week = document.createElement('button')
    btn_increase_week.type="button"
    btn_increase_week.innerHTML = '>>'
    inp_due_date.parentNode.insertBefore(btn_increase_week, inp_due_date.nextSibling.nextSibling )

    btn_increase = document.createElement('button')
    btn_increase.type="button"
    btn_increase.innerHTML = '>'
    inp_due_date.parentNode.insertBefore(btn_increase, inp_due_date.nextSibling.nextSibling )

    btn_decrease_week.addEventListener('click', function() {
      adjustDate(-7)
    });
    btn_decrease.addEventListener('click', function() {
      adjustDate(-1)
    });

    btn_increase_week.addEventListener('click', function() {
      adjustDate(7)
    });
    btn_increase.addEventListener('click', function() {
      adjustDate(1)
    });

</script>

{% endblock %}
